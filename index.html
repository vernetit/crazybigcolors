<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parejas de Colores ‚Äî Ruido Progresivo (10x10)</title>
  <style>
    :root{
      --bg:#0b0e14; --card:#121826; --muted:#98a2b3; --text:#e6e6e6; --acc:#7c3aed; --good:#16a34a; --bad:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 70% -10%, #1b2236, var(--bg));
         font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
         color:var(--text)}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:16px 24px;}
    .title{font-size:18px;font-weight:700;letter-spacing:.3px}
    .wrap{display:grid;grid-template-columns: 320px 1fr;gap:16px;padding:0 24px 24px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
           border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px 14px}
    .panel h3{margin:4px 0 8px;font-size:14px;color:#cbd5e1}
    .controls label{display:block;font-size:12px;color:var(--muted);margin:12px 0 6px}
    .controls input[type="range"], .controls input[type="number"], .controls select{width:100%}
    .row{display:flex;gap:8px;align-items:center}
    .btn{background:var(--acc);border:none;color:white;padding:10px 14px;font-weight:700;border-radius:12px;cursor:pointer;box-shadow:0 6px 20px rgba(124,58,237,.35);}
    .btn:active{transform:translateY(1px)}
    .stats{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .stat{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);padding:8px 10px;border-radius:10px;font-size:12px}
    #board{display:grid;gap:6px;grid-template-columns: repeat(10, 1fr);padding:12px}
    .cell{position:relative;aspect-ratio:1;border-radius:10px;overflow:hidden;background:#0f1422;border:1px solid rgba(255,255,255,.06);cursor:pointer;transition:transform .06s ease, border-color .2s ease, filter .2s ease;}
    .cell:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.22)}
    .cell.selected{outline:2px solid #38bdf8;filter:drop-shadow(0 0 10px rgba(56,189,248,.3))}
    .cell.cleared{opacity:.06;pointer-events:none;filter:grayscale(1)}
    canvas.pixel{width:100%;height:100%;display:block}
    .footer{font-size:11px;color:var(--muted);text-align:center;padding:8px}
    .palette{display:grid;grid-template-columns:repeat(10,1fr);gap:6px;margin-top:8px}
    .sw{height:18px;border-radius:6px;border:1px solid rgba(255,255,255,.15)}
    .panel2 {
  transform: scale(0.6);
  transform-origin: top left;
}

  </style>
</head>
<body>
  <header>
    <div class="title">üéØ Parejas de Colores ‚Äî 10√ó10 con ruido</div>
    <div class="stats">
      <div class="stat">Puntaje: <b id="score">0</b></div>
      <div class="stat">Pares encontrados: <b id="found">0</b>/<b id="totalPairs">0</b></div>
      <div class="stat">Se√±al actual: <b id="signalPct">0%</b></div>
      <div class="stat">Tiempo: <b id="clock">00:00</b></div>
    </div>
  </header>

  <div class="wrap">
    <section class="panel">
      <h3>Controles</h3>
      <div class="controls">
        <label>Velocidad de tick (ms)
          <input id="tickMs" type="range" min="100" max="10000" step="100" value="5000">
        </label>
        <div class="row"><input id="tickMsNum" type="number" min="100" max="10000" step="50" value="5000"></div>

        <label>Ruido inicial (%)
          <input id="noiseStart" type="range" min="0" max="100" step="1" value="95">
        </label>
        <div class="row"><input id="noiseStartNum" type="number" min="0" max="100" step="1" value="95"></div>

        <label>Disminuci√≥n de ruido por tick (puntos %)
          <input id="noiseDecay" type="range" min="0" max="10" step="0.1" value="0.5">
        </label>
        <div class="row"><input id="noiseDecayNum" type="number" min="0" max="10" step="0.5" value="1.5"></div>

        <label>Tama√±o de celda (px)
          <input id="cellPx" type="range" min="24" max="90" step="2" value="48">
        </label>
        <div class="row"><input id="cellPxNum" type="number" min="24" max="90" step="2" value="38"></div>

        <label>Nivel objetivo final de se√±al (%)
          <input id="targetSignal" type="range" min="30" max="100" step="1" value="85">
        </label>
        <div class="row"><input id="targetSignalNum" type="number" min="30" max="100" step="1" value="85"></div>

        <div class="row" style="margin-top:12px;gap:10px">
          <button class="btn" id="newGame">Nueva partida</button>
          <button class="btn" id="pauseBtn" style="background:#0891b2">Pausar</button>
        </div>

        <h3>Paleta (10 colores)</h3>
        <div id="palette" class="palette"></div>
      </div>
    </section>

    <section class="panel2 panel" style="zoom:0.75;">
        <!--board -->
      <div id="board"></div>
      <div class="footer">Seleccion√° dos celdas con el mismo color objetivo. A medida que baja el ruido, la ‚Äúse√±al‚Äù del color domina.
      </div>
    </section>
  </div>

  <script>
    // === Configuraci√≥n base ===
    const GRID_N = 10;               // 10x10
    const COLORS = [
    '#dc143c', // rojo  
    '#32cd32', // verde  
    '#1e90ff', // azul  
    '#ffd700', // amarillo  
    '#ff8c00', // naranja  
    '#8a2be2', // violeta  
    '#00ffff', // cian  
    '#ff69b4', // rosa  
    '#a0522d', // marr√≥n  
    '#708090', // gris azulado  

    ];

    // Render de paleta visual
    const $palette = document.querySelector('#palette');
    COLORS.forEach(c=>{ const d=document.createElement('div'); d.className='sw'; d.style.background=c; $palette.appendChild(d); });

    // Estado de juego
    let board = [];          // [{id, targetColorIdx, cleared:false, selected:false}]
    let signal = 0;          // porcentaje de p√≠xeles de color objetivo (0..100)
    let targetSignal = 85;   // meta
    let noiseStart = 95;     // % inicial de ruido (=> signal inicial = 10)
    let noiseDecay = 0.5;    // puntos porcentuales que se quitan del ruido por tick
    let tickMs = 5000;        // cada cu√°nto actualizamos los canvas
    let cellPx = 48;         // lado en px
    let timer = null;        // interval loop
    let running = true;
    let score = 0; let foundPairs = 0; let totalPairs = 0; let startedAt = null; let clockTimer=null;

    // DOM
    const $board = document.querySelector('#board');
    const $score = document.querySelector('#score');
    const $found = document.querySelector('#found');
    const $totalPairs = document.querySelector('#totalPairs');
    const $signalPct = document.querySelector('#signalPct');
    const $clock = document.querySelector('#clock');

    // Controles
    bindRangeLink('tickMs', v=>{ tickMs = +v; restartLoop(); });
    bindRangeLink('noiseStart', v=>{ noiseStart = +v; });
    bindRangeLink('noiseDecay', v=>{ noiseDecay = +v; });
    bindRangeLink('cellPx', v=>{ cellPx = +v; resizeCells(); });
    bindRangeLink('targetSignal', v=>{ targetSignal = +v; });

    document.querySelector('#newGame').addEventListener('click', newGame);
    document.querySelector('#pauseBtn').addEventListener('click', ()=>{
      running = !running;
      document.querySelector('#pauseBtn').textContent = running? 'Pausar':'Reanudar';
      if(running){ restartLoop(); startClock(); } else { clearInterval(timer); clearInterval(clockTimer); }
    });

    function bindRangeLink(id, onChange){
      const r = document.getElementById(id);
      const n = document.getElementById(id+'Num');
      const sync = (v)=>{ r.value=v; n.value=v; onChange(v); };
      r.addEventListener('input', e=> sync(e.target.value));
      n.addEventListener('input', e=> sync(e.target.value));
      // init
      n.value = r.value; onChange(r.value);
    }

    function newGame(){
      clearInterval(timer); clearInterval(clockTimer);
      running = true; document.querySelector('#pauseBtn').textContent = 'Pausar';
      score = 0; foundPairs = 0; $score.textContent = score; $found.textContent = foundPairs;
      startedAt = Date.now(); startClock();

      // Se√±al inicial derivada del ruido inicial
      signal = Math.max(0, 100 - noiseStart);

      // Generamos 50 pares (100 celdas)
      const pairs = GRID_N*GRID_N/2; totalPairs = pairs; $totalPairs.textContent = pairs;
      const targets = [];
      for(let i=0;i<pairs;i++){ const colorIdx = i % COLORS.length; targets.push(colorIdx, colorIdx); }
      // mezclamos
      shuffle(targets);

      board = targets.map((tc, idx)=>({ id: idx, targetColorIdx: tc, cleared:false, selected:false, canvas:null }));

      // Render tablero
      $board.style.gridTemplateColumns = `repeat(${GRID_N}, 1fr)`;
      $board.innerHTML = '';
      board.forEach(cell=>{
        const div = document.createElement('div');
        div.className = 'cell';
        div.style.width = '100%';
        div.addEventListener('click', ()=> onCellClick(cell, div));
        const cv = document.createElement('canvas');
        cv.className = 'pixel';
        // usaremos 24x24 p√≠xeles l√≥gicos y escalamos al 100%
        cv.width = 24; cv.height = 24;
        div.appendChild(cv);
        cell.canvas = cv;
        $board.appendChild(div);
      });

      resizeCells();
      drawAll();
      restartLoop();
    }

    function resizeCells(){
      document.querySelectorAll('.cell').forEach(el=>{
        el.style.minWidth = cellPx+'px';
      });
    }

    function restartLoop(){
      clearInterval(timer);
      if(!running) return;
      timer = setInterval(()=>{
        // sube se√±al hasta targetSignal
        const noise = 100 - signal;
        if(noise > (100 - targetSignal)){
          const nextNoise = Math.max(100 - targetSignal, noise - noiseDecay);
          signal = 100 - nextNoise;
        }
        drawAll();
      }, tickMs);
    }

    function startClock(){
      const fmt = (s)=> s<10? '0'+s : s;
      clockTimer = setInterval(()=>{
        const d = Math.floor((Date.now()-startedAt)/1000);
        const m = Math.floor(d/60); const s = d%60; $clock.textContent = `${fmt(m)}:${fmt(s)}`;
      }, 200);
    }

    function onCellClick(cell, div){
      if(cell.cleared) return;
      // marcar selecci√≥n
      cell.selected = !cell.selected;
      div.classList.toggle('selected', cell.selected);
      const selected = board.filter(c=> c.selected && !c.cleared);
      if(selected.length === 2){
        // comprobar pareja
        const [a,b] = selected;
        if(a.targetColorIdx === b.targetColorIdx){
          // calcular puntos en funci√≥n de se√±al actual (m√°s dif√≠cil con poco signal)
          const base = 10; const bonus = Math.round((signal/100)*10);
          score += base + bonus; $score.textContent = score;
          a.cleared = b.cleared = true; a.selected = b.selected = false;
          // visual
          a.canvas.parentElement.classList.add('cleared');
          b.canvas.parentElement.classList.add('cleared');
          foundPairs++; $found.textContent = foundPairs;
          if(foundPairs === totalPairs){
            clearInterval(timer); clearInterval(clockTimer);
            $signalPct.textContent = '100%';
            alert(`¬°Ganaste! Puntaje: ${score}`);
          }
        }else{
          // breve feedback negativo
          score = Math.max(0, score-2); $score.textContent = score;
          setTimeout(()=>{
            a.selected = b.selected = false;
            a.canvas.parentElement.classList.remove('selected');
            b.canvas.parentElement.classList.remove('selected');
          }, 220);
        }
      }
    }

    function drawAll(){
      $signalPct.textContent = Math.round(signal) + '%';
      for(const cell of board){
        drawCell(cell.canvas, COLORS[cell.targetColorIdx], signal);
      }
    }

    // Dibuja un mosaico de 24x24 donde 'signalPct' define % de p√≠xeles del color objetivo y el resto es ruido de la paleta
    function drawCell(cv, targetHex, signalPct){
      const ctx = cv.getContext('2d');
      const w = cv.width|0, h = cv.height|0;
      const total = w*h;
      const targetCount = Math.round(total * (signalPct/100));
      // construimos una bolsa de √≠ndices con targetCount del objetivo y resto ruido
      const idxs = new Uint8Array(total);
      for(let i=0;i<targetCount;i++) idxs[i] = 1; // 1 = target
      // fisher-yates para mezclar
      for(let i=total-1;i>0;i--){ const j=(Math.random()* (i+1))|0; const t=idxs[i]; idxs[i]=idxs[j]; idxs[j]=t; }

      const img = ctx.createImageData(w,h);
      const [tr,tg,tb] = hex2rgb(targetHex);
      for(let i=0;i<total;i++){
        let r,g,b;
        if(idxs[i]===1){ r=tr; g=tg; b=tb; }
        else{ const rnd = COLORS[(Math.random()*COLORS.length)|0]; [r,g,b] = hex2rgb(rnd); }
        const o = i*4; img.data[o]=r; img.data[o+1]=g; img.data[o+2]=b; img.data[o+3]=255;
      }
      ctx.putImageData(img,0,0);
    }

    function hex2rgb(hex){
      const h = hex.replace('#','');
      const r = parseInt(h.slice(0,2),16), g=parseInt(h.slice(2,4),16), b=parseInt(h.slice(4,6),16);
      return [r,g,b];
    }

    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]]; } return a; }

    // inicializar
    window.addEventListener('load', ()=> newGame());
  </script>
</body>
</html>

